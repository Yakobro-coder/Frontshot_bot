## Телеграм-бот который присылает скриншот веб-страницы в ответ на присланную боту ссылку. 

### Техническое описание:

- Бот работает и в личных сообщениях и при добавлении в чат
- Настройки бот берёт из переменных окружения или .env файла
- Бот и необходимые ему сервисы разворачиваются в контейнерах с помощью Docker-Compose
- Зависимости бота указаны в requirements.txt
- Процесс получения скриншота не блокирует работу бота (бот передаёт задачу в celery и продолжать отвечать на сообщения от других пользователей)
- При получении сообщения с ссылкой, бот присылает сообщение-заглушку, о том что запрос принят, и запускает процесс получения скриншота в фоне
- Когда скриншот получен, бот редактирует сообщение-заглушку:
  - Прикрепляет скриншот к сообщению
  - Заменяет текст сообщения на заголовок сайта, URL и время обработки страницы
  - Добавляет к сообщению кнопку “Подробнее”, которая показывает WHOIS сайта
- Скриншоты бот так же сохраняет в файловую систему, прописывая в имени файла: дату запроса, user_id пользователя, домен из url запроса
- Бот сохраняет статистику о своей работе в базу данных - PostgreSQL(msg_id, user_id, date_msg, url)

### Для запуска проекта, необходимо выполнить команду:

`docker-compose up -d --build`

 Которая выполнит сборку контейнеров по Dockerfile, после чего запустит их с прописанными условиями запуска в docker-compose.yml
 
После того как контейнеры поднимутся, необходимо выполнить следующую команду что бы зайти в окружение контейнера с телеграм ботом, и от туда запустить команду для создания таблицы в базе данных:

`docker exec -ti telegram_bot sh`

`python3 ./postgres_stat/create_tb.py`

После чего все обращения к боту будут записывать в БД, по которым можно будет сделать анализ:

* Частота использования в час/день/месяц/год.
* Самые популярные сайты переданные в бот.
* Количество запросов по каждому пользователю.

Зайти и проверить записи в БД можно следующими командами:

`docker exec -ti postgres_bot sh`

`psql -h localhost postgres  -U myusername`

`SELECT * FROM using_bot;`

В файле **.env** указан токент телеграм бота, который можно использовать для тестирования проекта.


### Телеграм_Бот:
- https://t.me/Frontshot_bot
- @Frontshot_bot